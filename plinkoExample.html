<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Plinko Game</title>
    <style>
      /* Ваши стили здесь */
      .btn-disabled {
        pointer-events: none;
        opacity: 0.5;
      }
      #plinkoContainer {
        position: relative;
        width: 400px;
        height: 400px;
        margin: auto;
        background: #f0f0f0;
      }
      .pin {
        position: absolute;
        background: #2052f7;
        border-radius: 50%;
        transform: translate(-50%, -50%);
      }
      .ball {
        position: absolute;
        background: #ffd700;
        border-radius: 50%;
        transform: translate(-50%, -50%);
      }
      .bucket {
        position: absolute;
        background: #ccc;
        border-radius: 5px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 12px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="content">
      <div class="mines">
        <div class="content-body">
          <div class="container">
            <div class="one">
              <button id="startGame" class="btn-play">Начать игру</button>
              <button id="autoBet" class="btn-play">Автоигра</button>
              <input
                id="betInput"
                type="number"
                value="1.00"
                min="1"
                max="1000000"
              />
              <div id="history"></div>
            </div>
            <div id="w_container">
              <div id="plinkoContainer"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const game = {
          pins: 8,
          difficulty: "medium",
          multipliers: {
            low: [1, 2, 3, 4, 5, 6, 7, 8, 9],
            medium: [2, 4, 6, 8, 10, 12, 14, 16, 18],
            high: [5, 10, 15, 20, 25, 30, 35, 40, 45],
          },
          history: [],
          balls: 0,
        };

        const plinkoContainer = document.getElementById("plinkoContainer");
        const startGameButton = document.getElementById("startGame");
        const autoBetButton = document.getElementById("autoBet");
        const betInput = document.getElementById("betInput");
        const historyContainer = document.getElementById("history");

        let autoBetInterval = null;

        // Инициализация игрового поля
        createBoard(game.pins);

        // Обработчики событий
        startGameButton.addEventListener("click", playGame);
        autoBetButton.addEventListener("click", switchAutoBet);

        // Функция создания игрового поля
        function createBoard(pins) {
          plinkoContainer.innerHTML = "";
          const size = pins + 2;

          for (let row = 2; row <= size; row++) {
            for (let pos = 0; pos <= row; pos++) {
              const left = 50 + (pos - row / 2) * (100 / (size + 2));
              const top = (row + 1 - 2) * (100 / (size + 2));
              const widthHeight = 100 / (row === size ? 3 : 5) / (size + 2);

              if (row === size) {
                if (pos !== 0 && pos !== size) {
                  const bucket = document.createElement("div");
                  bucket.className = `bucket bucket-${pos}`;
                  bucket.style.top = `${top}%`;
                  bucket.style.left = `${left}%`;
                  bucket.style.width = `${widthHeight * 2.5}%`;
                  bucket.style.height = `${widthHeight * 2.5}%`;
                  bucket.textContent = getMultiplier(pos);
                  plinkoContainer.appendChild(bucket);
                }
              } else {
                const pin = document.createElement("div");
                pin.className = "pin";
                pin.style.top = `${top}%`;
                pin.style.left = `${left}%`;
                pin.style.width = `${widthHeight * 1.5}%`;
                pin.style.height = `${widthHeight * 1.5}%`;
                plinkoContainer.appendChild(pin);
              }
            }
          }
        }

        // Функция получения множителя
        function getMultiplier(position) {
          const multiplier = game.multipliers[game.difficulty][position - 1];
          return multiplier >= 1000 ? `${multiplier / 1000}K` : multiplier;
        }

        // Функция начала игры
        function playGame() {
          if (game.balls > 0) return; // Игра уже идет
          const bet = parseFloat(betInput.value);
          if (isNaN(bet)) return alert("Некорректная ставка");

          game.balls += 1;
          const target = Math.floor(Math.random() * game.pins) + 1;
          const result = bet * getMultiplier(target);
          animateBall(target, result);
        }

        // Функция анимации шарика
        function animateBall(target, result) {
          const ball = document.createElement("div");
          ball.className = "ball";
          ball.style.top = "0%";
          ball.style.left = "50%";
          ball.style.width = "20px";
          ball.style.height = "20px";
          plinkoContainer.appendChild(ball);

          let step = 0;
          const totalSteps = game.pins + 2; // Общее количество шагов
          const duration = 2000; // Общее время анимации в миллисекундах (2 секунды)
          const stepDuration = duration / totalSteps; // Время для каждого шага

          const interval = setInterval(() => {
            step += 1;
            if (step > totalSteps) {
              clearInterval(interval);
              game.balls -= 1;
              updateHistory(result);
              ball.remove();
              return;
            }
            const left = 50 + (Math.random() - 0.5) * 20; // Случайное смещение
            ball.style.top = `${step * (100 / totalSteps)}%`;
            ball.style.left = `${left}%`;
          }, stepDuration);
        }

        // Функция обновления истории
        function updateHistory(result) {
          const historyItem = document.createElement("div");
          historyItem.textContent = `Выигрыш: ${result.toFixed(2)}x`;
          historyContainer.prepend(historyItem);
          if (historyContainer.children.length > 15) {
            historyContainer.lastChild.remove();
          }
        }

        // Функция автоигры
        function switchAutoBet() {
          if (autoBetInterval) {
            clearInterval(autoBetInterval);
            autoBetInterval = null;
            autoBetButton.textContent = "Автоигра";
          } else {
            autoBetInterval = setInterval(playGame, 3000); // Интервал между играми в авторежиме
            autoBetButton.textContent = "Остановить";
          }
        }
      });
    </script>
  </body>
</html>
